"use strict";angular.module("gpConnect",["ngResource","ngTouch","ngAnimate","ui.router","ui.bootstrap","angular-loading-bar","growlNotifications","angularUtils.directives.dirPagination","ui.timepicker","ui.calendar","angularSpinner"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("patients-list",{url:"/patients?ageRange&department&order&reverse",views:{main:{templateUrl:"views/patients/patients-list.html",controller:"PatientsListCtrl"}},params:{patientsList:[],advancedSearchParams:[],displayEmptyTable:!1}}).state("main-search",{url:"/search",views:{main:{templateUrl:"views/search/main-search.html",controller:"MainSearchController"}}}).state("patients-summary",{url:"/patients/{patientId:int}/patients-summary",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/patients/patients-summary.html",controller:"PatientsSummaryCtrl"}}}).state("problem-list",{url:"/patients/{patientId:int}/problem",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/problem/problem-list.html",controller:"ProblemListCtrl"}}}).state("problem-detail",{url:"/patients/{patientId:int}/problem/{problemIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/problem/problem-list.html",controller:"ProblemListCtrl"},detail:{templateUrl:"views/problem/problem-detail.html",controller:"ProblemDetailCtrl"}}}).state("allergies",{url:"/patients/{patientId:int}/allergies",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"}}}).state("allergies-detail",{url:"/patients/{patientId:int}/allergies/{allergyIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"},detail:{templateUrl:"views/allergies/allergies-detail.html",controller:"AllergiesDetailCtrl"}}}).state("medications",{url:"/patients/{patientId:int}/medications",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"}}}).state("medications-detail",{url:"/patients/{patientId:int}/medications/{medicationIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"},detail:{templateUrl:"views/medications/medications-detail.html",controller:"MedicationsDetailCtrl"}}}).state("procedures",{url:"/patients/{patientId:int}/procedures",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"}}}).state("procedures-detail",{url:"/patients/{patientId:int}/procedures/{procedureId}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"},detail:{templateUrl:"views/procedures/procedures-detail.html",controller:"ProceduresDetailCtrl"}}}).state("referrals",{url:"/patients/{patientId:int}/referrals",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralsListCtrl"}}}).state("referrals-detail",{url:"/patients/{patientId:int}/referrals/{referralId}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralsListCtrl"},detail:{templateUrl:"views/referrals/referrals-detail.html",controller:"ReferralsDetailCtrl"}}}).state("observations",{url:"/patients/{patientId:int}/observations",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/observations/observations-list.html",controller:"ObservationsListCtrl"}}}).state("results-detail",{url:"/patients/{patientId:int}/results/{resultIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/results/observations-list.html",controller:"ResultsListCtrl"},detail:{templateUrl:"views/results/observations-detail.html",controller:"ResultsDetailCtrl"}}}).state("encounters",{url:"/patients/{patientId:int}/encounters",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/encounters/encounters-list.html",controller:"EncountersListCtrl"}}}).state("encounters-detail",{url:"/patients/{patientId:int}/encounters/{encounterIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/encounters/encounters-list.html",controller:"EncountersListCtrl"},detail:{templateUrl:"views/encounters/encounters-detail.html",controller:"EncountersDetailCtrl"}}}).state("immunisations",{url:"/patients/{patientId:int}/immunisations",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/immunisations/immunisations-list.html",controller:"ImmunisationsListCtrl"}}}).state("immunisations-detail",{url:"/patients/{patientId:int}/immunisations/{immunisationIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/immunisations/immunisations-list.html",controller:"ImmunisationsListCtrl"},detail:{templateUrl:"views/immunisations/immunisations-detail.html",controller:"ImmunisationsDetailCtrl"}}}).state("adminitems",{url:"/patients/{patientId:int}/adminitems",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/adminitems/adminitems-list.html",controller:"AdminItemsListCtrl"}}}).state("adminitems-detail",{url:"/patients/{patientId:int}/adminitems/{adminItemIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/adminitems/adminitems-list.html",controller:"AdminItemsListCtrl"},detail:{templateUrl:"views/adminitems/adminitems-detail.html",controller:"AdminItemsDetailCtrl"}}}).state("clinicalitems",{url:"/patients/{patientId:int}/clinicalitems",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/clinicalitems/clinicalitems-list.html",controller:"ClinicalItemsListCtrl"}}}).state("clinicalitems-detail",{url:"/patients/{patientId:int}/clinicalitems/{clinicalItemIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/clinicalitems/clinicalitems-list.html",controller:"ClinicalItemsListCtrl"},detail:{templateUrl:"views/clinicalitems/clinicalitems-detail.html",controller:"ClinicalItemsDetailCtrl"}}}).state("investigations",{url:"/patients/{patientId:int}/investigations",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/investigations/investigations-list.html",controller:"InvestigationsListCtrl"}}}).state("investigations-detail",{url:"/patients/{patientId:int}/investigations/{investigationIndex}?filter&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/investigations/investigations-list.html",controller:"InvestigationsListCtrl"},detail:{templateUrl:"views/investigations/investigations-detail.html",controller:"InvestigationsDetailCtrl"}}}).state("appointments",{url:"/patients/{patientId:int}/appointments",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/appointments/appointments.html",controller:"AppointmentsCtrl"}}})}]).directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(a,b,c,d){d.$formatters.unshift()}}}).directive("mySpace",function(){return function(a,b,c){b.bind("keydown keypress",function(b){32===b.which&&(a.$apply(function(){a.$eval(c.myEnter)}),b.preventDefault())})}}).directive("autoFocus",["$timeout",function(a){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(b,c,d,e){b.$watch("ngModel",function(b){a(function(){c[0].focus()})})}}}]).directive("isValidNhsNumber",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(a){e(a)}),d.$parsers.unshift(function(a){return e(a)});var e=function(a){if(a){var b=a.replace(/\s+/g,""),c=!isNaN(b)&&10===b.length;return d.$setValidity("invalidNHSNumFormat",c),c?b:""}}}}}).filter("formatNHSNumber",function(){return function(a){return void 0!==a?a.slice(0,3)+" "+a.slice(3,6)+" "+a.slice(6):void 0}}).constant("keyCodes",{esc:27,enter:13}).directive("keyBind",["keyCodes",function(a){function b(b){var c={};for(var d in b){var e=b[d];a.hasOwnProperty(d)&&(c[a[d]]=e)}return c}return function(a,c,d){var e=b(a.$eval(d.keyBind));c.bind("keydown keypress",function(b){e.hasOwnProperty(b.which)&&a.$apply(function(){a.$eval(e[b.which])})})}}]).directive("focusElement",["$timeout",function(a){return{link:function(b,c,d){b.$watch(d.focusElement,function(b){a(function(){b===!0&&c.focus()})})}}}]).directive("rpOnLoad",["$parse",function(a){return function(b,c,d){var e=a(d.rpOnLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}]).config(["datepickerConfig","datepickerPopupConfig","cfpLoadingBarProvider",function(a,b,c){a.startingDay=1,b.showButtonBar=!1,b.datepickerPopup="dd-MMM-yyyy",c.includeSpinner=!1}]).config(["paginationTemplateProvider",function(a){a.setPath("views/dirPagination.tpl.html")}]),angular.module("gpConnect").value("claims",{sub:"28AD8576-1948-4C84-8B5E-55FB7EE027CE",given_name:"Bob",family_name:"Smith",email:"gpconnect@example.com",date_of_birth:"19/04/2016",scope:{setting1:!0,setting2:!0},tenant_id:"HSCIC",tenant_name:"GP Connect",role:"gpconnect"}),angular.module("gpConnect").value("content",{gpconnect_title:"GP Connect Demonstrator"}),angular.module("gpConnect").factory("UserService",["$location","$http","claims","content",function(a,b,c,d){var e={role:c.role,email:c.email,tenant:{id:c.tenant_id,name:c.tenant_name},firstName:c.given_name,surname:c.family_name,dateOfBirth:c.date_of_birth,isAuthenticated:!0,feature:c.scope},f=function(){var b=a.search();e.email=b.email||e.email,e.role=b.role||e.role},g=function(){return e},h=function(a){return d[a]};return{setCurrentUserFromQueryString:f,getCurrentUser:g,getContent:h}}]),angular.module("gpConnect").factory("PatientService",["$http",function(a){var b=function(){return a.get("/api/patients")},c=function(b){var c={cache:!0};return a.get("/api/patients/"+b,c)},d=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Summary"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')};return{findAllSummaries:b,findDetails:c,getSummary:d}}]),angular.module("gpConnect").factory("Problem",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/problem")},c=function(b,c,d){return a.get("/api/patients/"+b+"/problem/"+c+"?source="+d)},d=function(b,c){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Problems"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/problem",c)},f=function(b,c){return a.put("/api/patients/"+b+"/problem",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,update:f,create:e}}]),angular.module("gpConnect").factory("Allergy",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/allergies")},c=function(b,c,d){return a.get("/api/patients/"+b+"/allergies/"+c+"?source="+d)},d=function(b,c){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Allergies and Sensitivities"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/allergies",c)},f=function(b,c){return a.put("/api/patients/"+b+"/allergies",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("Medication",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/medications")},c=function(b,c,d){return a.get("/api/patients/"+b+"/medications/"+c+"?source="+d)},d=function(b,c){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Medications"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/medications",c)},f=function(b,c){return a.put("/api/patients/"+b+"/medications",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("Appointment",["$http",function(a){var b=function(b){return a.get("/fhir/Patient?patientId="+b).then(function(b){return a.get("/fhir/Patient/"+b.data.entry[0].resource.id+"/Appointment")})},c=function(b){return a.get("/fhir/"+b)},d=function(b,c){return a.post("/api/patients/"+b+"/appointments",c)};return{findAllAppointments:b,findResourceByReference:c,create:d}}]),angular.module("gpConnect").factory("Referral",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/referrals")},c=function(b,c){return a.get("/api/patients/"+b+"/referrals/"+c)},d=function(b,c){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Referrals"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/referrals",c)},f=function(b,c){return a.put("/api/patients/"+b+"/referrals",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,update:f,create:e}}]),angular.module("gpConnect").factory("Procedure",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/procedures")},c=function(b,c,d){return a.get("/api/patients/"+b+"/procedures/"+c+"?source="+d)},d=function(b,c){return a.post("/api/patients/"+b+"/procedures",c)},e=function(b,c){return a.put("/api/patients/"+b+"/procedures",c)},f=function(b,c){return a.get("/api/patients/"+b+"/procedures/htmlTables?source="+c)};return{findAllSummaries:b,findDetails:c,update:e,create:d,findAllHTMLTables:f}}]),angular.module("gpConnect").factory("DateFormatter",function(){var a=function(a){return moment(a).format("YYYY-MM-DD")};return{clean:a}}),angular.module("gpConnect").factory("Observation",["$http",function(a){var b=function(b,c){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Observations"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')};return{findAllHTMLTables:b}}]),angular.module("gpConnect").factory("AdvancedSearch",["$modal","$http",function(a,b){var c=!0,d=function(b){if(c){c=!1;var d=a.open({templateUrl:"views/search/advanced-search-modal.html",size:"lg",controller:"AdvancedSearchController",resolve:{modal:function(){return{title:"Advanced Search"}},searchParams:function(){var a={};return isNaN(b)?a.surname=b:a.nhsNumber=b,a}}})}d.result.then(function(){c=!0},function(){c=!0})},e=function(a){return b.post("/api/patients/advancedSearch",a)};return{isModalClosed:c,openAdvancedSearch:d,searchByDetails:e}}]),angular.module("gpConnect").factory("Encounter",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/encounters")},c=function(b,c){return a.get("/api/patients/"+b+"/encounters/"+c)},d=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Encounters"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/encounters",c)},f=function(b,c){return a.put("/api/patients/"+b+"/encounters",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("Immunisation",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/immunisations")},c=function(b,c){return a.get("/api/patients/"+b+"/immunisations/"+c)},d=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Immunisations"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/immunisations",c)},f=function(b,c){return a.put("/api/patients/"+b+"/immunisations",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("AdminItem",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/adminitems")},c=function(b,c){return a.get("/api/patients/"+b+"/adminitems/"+c)},d=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Administrative Items"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/adminitems",c)},f=function(b,c){return a.put("/api/patients/"+b+"/adminitems",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("ClinicalItem",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/clinicalitems")},c=function(b,c){return a.get("/api/patients/"+b+"/clinicalitems/"+c)},d=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Clinical Items"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')},e=function(b,c){return a.post("/api/patients/"+b+"/clinicalitems",c)},f=function(b,c){return a.put("/api/patients/"+b+"/clinicalitems",c)};return{findAllSummaries:b,findDetails:c,findAllHTMLTables:d,create:e,update:f}}]),angular.module("gpConnect").factory("Investigation",["$http",function(a){var b=function(b){return a.post("/fhir/Patient/$getcarerecord",'{"resourceType" : "Parameters","parameter" : [{"name" : "patientNHSNumber","valueIdentifier" : { "value" : "'+b+'" }},{"name" : "recordSection","valueString" : "Investigations"},{"name" : "timePeriod","valuePeriod" : { "start" : "2015", "end" : "2016" }}]}')};return{findAllHTMLTables:b}}]),angular.module("gpConnect").controller("PatientsListCtrl",["$scope","$state","$stateParams","$location","$modal","PatientService",function(a,b,c,d,e,f){0!=c.patientsList.length||c.displayEmptyTable?(a.patients=c.patientsList,d.url(d.path()),a.filters={advancedSearch:!0,advancedSearchParams:c.advancedSearchParams}):(f.findAllSummaries().then(function(b){a.patients=b.data}),a.order=c.order||"name",a.reverse="true"===c.reverse,a.filters={department:c.department,ageRange:c.ageRange}),a.sort=function(d){var e=a.reverse;a.order===d&&(e=!e),b.transitionTo(b.current,_.extend(c,{order:d,reverse:e}))},a.sortClass=function(b){return a.order===b?a.reverse?"sort-desc":"sort-asc":void 0},a.go=function(c){b.go("patients-summary",{patientId:c.id,patientsList:a.patients})},a.patientFilter=function(b){return a.filters.department?b.department===a.filters.department:a.filters.ageRange?b.ageRange===a.filters.ageRange:!0},a.openAdvancedSearch=function(){e.open({templateUrl:"views/search/advanced-search-modal.html",size:"lg",controller:"AdvancedSearchController",resolve:{modal:function(){return{title:"Advanced Search"}},searchParams:function(){return c.advancedSearchParams}}})}}]),angular.module("gpConnect").controller("headerController",["$scope","$rootScope","$state","usSpinnerService","$stateParams","UserService",function(a,b,c,d,e,f){switch(f.setCurrentUserFromQueryString(),a.currentUser=f.getCurrentUser(),a.currentUser.role){case"gpconnect":c.go("main-search");break;case"phr":c.go("patients-summary",{patientId:9999999e3});break;default:c.go("patients-summary",{patientId:9999999e3})}b.$on("$stateChangeSuccess",function(b,d){var e="",g="",h="",i=0,j=0;switch(d.name){case"main-search":e="",g="Welcome",h="",i=12,j=0;break;case"patients-list":e="main-search",g="Patient Lists",h="Patient Dashboard",i=12,j=0;break;case"patients-summary":e="patients-list",g="Patient Summary",h="Patient Lists",i=11,j=0;break;case"patients-lookup":e="",g="Patients lookup",h="",i=6,j=6;break;default:e="patients-list",g="Patients Details",h="Patient Lists",i=11,j=0}a.pageHeader=g,a.previousState=e,a.previousPage=h,a.mainWidth=i,a.detailWidth=j,a.goBack=function(){history.back()},a.userContextViewExists="user-context"in c.current.views,a.actionsExists="actions"in c.current.views,a.go=function(a){c.go("patients-summary",{patientId:a.id})},"gpconnect"===a.currentUser.role&&(a.title=f.getContent("gpconnect_title")),"phr"===a.currentUser.role&&(a.title=f.getContent("phr_title")),a.footer=f.getContent("gpconnect_footer"),a.goHome=function(){"gpconnect"===a.currentUser.role&&c.go("main-search"),"phr"===a.currentUser.role&&c.go("patients-summary",{patientId:9999999e3})}})}]),angular.module("gpConnect").controller("PatientsSummaryCtrl",["$scope","$stateParams","$state","$rootScope","$location","$sce","usSpinnerService","PatientService",function(a,b,c,d,e,f,g,h){a.patients=b.patientsList,h.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.getSummary(b.patientId).then(function(b){var c='{"provider":"No Data","html":"No patient summary available for this patient."}';a.patientSummary=JSON.parse(c),a.patientSummary.html=f.trustAsHtml(a.patientSummary.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.patientSummary.html=f.trustAsHtml(c.resource.section[0].text.div),a.patientSummary.provider=c.resource.section[0].code.text)}),g.stop("patientSummary-spinner")}),a.go=function(a){e.path(a)},a.goToSection=function(a){({patientId:b.patientId})}}]),angular.module("gpConnect").controller("PatientsDetailCtrl",["$scope","$stateParams","$state","PatientService",function(a,b,c,d){d.findDetails(b.patientId).then(function(b){a.patient=b.data}),a.goTo=function(a){var d={patientId:b.patientId},e="";switch(a){case"summary":e="patients-summary";break;case"problem":e="problem-list";break;case"allergies":e="allergies";break;case"medications":e="medications";break;case"referrals":e="referrals";break;case"appointments":e="appointments";break;case"encounters":e="encounters";break;case"procedures":e="procedures";break;case"observations":e="observations";break;case"investigations":e="investigations";break;case"immunisations":e="immunisations";break;case"adminitems":e="adminitems";break;case"clinicalitems":e="clinicalitems"}c.go(e,d)}}]),angular.module("gpConnect").controller("ProblemListCtrl",["$scope","$state","$stateParams","$location","$sce","$modal","usSpinnerService","PatientService","Problem",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.problem).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfOnset).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No problems data available for this patient."}';a.problemTable=JSON.parse(c),a.problemTable.html=e.trustAsHtml(a.problemTable.html);var d=b.data,f=d.entry;$.each(f,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.problemTable.html=e.trustAsHtml(c.resource.section[0].text.div),a.problemTable.provider=c.resource.section[0].code.text)}),g.stop("problemSummary-spinner")}),a.go=function(d,e){b.go("problem-detail",{patientId:a.patient.id,problemIndex:d,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType,source:e})},a.selected=function(a){return a===c.problemIndex},a.create=function(){var c=f.open({templateUrl:"views/problem/problem-modal.html",size:"lg",controller:"ProblemModalCtrl",resolve:{modal:function(){return{title:"Create Problem"}},problem:function(){return{}},patient:function(){return a.patient}}});c.result.then(function(c){c.dateOfOnset=new Date(c.dateOfOnset);var d={code:c.code,dateOfOnset:c.dateOfOnset,description:c.description,problem:c.problem,terminology:c.terminology};i.create(a.patient.id,d).then(function(){setTimeout(function(){b.go("problem-list",{patientId:a.patient.id,filter:a.query,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("gpConnect").controller("ProblemDetailCtrl",["$scope","$stateParams","$location","$modal","$state","usSpinnerService","PatientService","Problem",function(a,b,c,d,e,f,g,h){g.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.findDetails(b.patientId,b.problemIndex,b.source).then(function(b){a.problem=b.data,f.stop("problemDetail-spinner")}),a.formDisabled=!0,a.edit=function(){var b=d.open({templateUrl:"views/problem/problem-modal.html",size:"lg",controller:"ProblemModalCtrl",resolve:{modal:function(){return{title:"Edit Problem"}},problem:function(){return angular.copy(a.problem)},patient:function(){return a.patient}}});b.result.then(function(b){var c={code:b.code,dateOfOnset:b.dateOfOnset,description:b.description,problem:b.problem,source:b.source,sourceId:b.sourceId,terminology:b.terminology};h.update(a.patient.id,c).then(function(){setTimeout(function(){e.go("problem-detail",{patientId:a.patient.id,problemIndex:b.sourceId,page:a.currentPage})},2e3)})})},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("gpConnect").controller("ProblemModalCtrl",["$scope","$modalInstance","UserService","problem","patient","modal",function(a,b,c,d,e,f){a.currentUser=c.getCurrentUser(),a.problem=d,a.patient=e,a.modal=f,a.protocol="http://","Edit Problem"===f.title?(a.problem.dateSubmitted=(new Date).toISOString().slice(0,10),a.problem.dateOfOnset=new Date(a.problem.dateOfOnset).toISOString().slice(0,10)):(a.problem.dateSubmitted=(new Date).toISOString().slice(0,10),a.problem.code="12393890"),a.changeProtocol=function(b){switch(b){case"http":a.protocol="http://";break;case"https":a.protocol="https://";break;default:a.protocol="http://"}},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("gpConnect").controller("AllergiesListCtrl",["$scope","$location","$stateParams","$sce","$modal","$state","usSpinnerService","PatientService","Allergy",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.cause).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.reaction).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No allergies data available for this patient."}';a.allergyTable=JSON.parse(c),a.allergyTable.html=d.trustAsHtml(a.allergyTable.html);var e=b.data,f=e.entry;$.each(f,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.allergyTable.html=d.trustAsHtml(c.resource.section[0].text.div),
a.allergyTable.provider=c.resource.section[0].code.text)}),g.stop("allergySummary-spinner")}),a.go=function(b,c){f.go("allergies-detail",{patientId:a.patient.id,allergyIndex:b,filter:a.query,page:a.currentPage,source:c})},a.selected=function(a){return a===c.allergyIndex},a.create=function(){var b=e.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Create Allergy"}},allergy:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){var c={sourceId:"",cause:b.cause,causeCode:b.causeCode,causeTerminology:b.causeTerminology,reaction:b.reaction,source:b.source};i.create(a.patient.id,c).then(function(){setTimeout(function(){f.go("allergies",{patientId:a.patient.id,filter:a.query,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("gpConnect").controller("AllergiesDetailCtrl",["$scope","$stateParams","$modal","$state","$location","usSpinnerService","PatientService","Allergy",function(a,b,c,d,e,f,g,h){g.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.findDetails(b.patientId,b.allergyIndex,b.source).then(function(b){a.allergy=b.data,f.stop("allergiesDetail-spinner")}),a.edit=function(){var b=c.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Edit Allergy"}},allergy:function(){return angular.copy(a.allergy)},patient:function(){return a.patient}}});b.result.then(function(b){var c={sourceId:b.sourceId,cause:b.cause,causeCode:b.causeCode,causeTerminology:b.causeTerminology,reaction:b.reaction,source:b.source};h.update(a.patient.id,c).then(function(){setTimeout(function(){d.go("allergies-detail",{patientId:a.patient.id,allergyIndex:b.sourceId,page:a.currentPage})},2e3)})})}}]),angular.module("gpConnect").controller("AllergiesModalCtrl",["$scope","$modalInstance","allergy","UserService","patient","modal",function(a,b,c,d,e,f){a.currentUser=d.getCurrentUser(),a.allergy=c,a.patient=e,a.modal=f,"Create Allergy"===f.title?(a.allergy.dateCreated=(new Date).toISOString().slice(0,10),a.allergy.causeCode="1239085",a.allergy.terminologyCode="12393890"):a.allergy.dateCreated=new Date(a.allergy.dateCreated).toISOString().slice(0,10),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("gpConnect").controller("MedicationsListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","usSpinnerService","PatientService","Medication",function(a,b,c,d,e,f,g,h,i){a.query={},a.queryBy="$",a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),h.findDetails(c.patientId).then(function(b){a.patient=b.data}),c.filter&&(a.query.$=c.filter),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No medication data available for this patient."}';a.medicationTable=JSON.parse(c),a.medicationTable.html=f.trustAsHtml(a.medicationTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.medicationTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.medicationTable.provider=c.resource.section[0].code.text)}),g.stop("medicationSummary-spinner")}),a.go=function(b,c){e.go("medications-detail",{patientId:a.patient.id,medicationIndex:b,filter:a.query.$,page:a.currentPage,source:c})},a.selected=function(a){return a===c.medicationIndex},a.create=function(){var b=d.open({templateUrl:"views/medications/medications-modal.html",size:"lg",controller:"MedicationsModalCtrl",resolve:{modal:function(){return{title:"Create Medication"}},medication:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.startDate=new Date(b.startDate),b.startTime=new Date(b.startTime.valueOf()-6e4*b.startTime.getTimezoneOffset());var c={doseAmount:b.doseAmount,doseDirections:b.doseDirections,doseTiming:b.doseTiming,medicationCode:b.medicationCode,medicationTerminology:b.medicationTerminology,name:b.name,route:b.route,startDate:b.startDate,startTime:b.startTime,author:b.author,dateCreated:b.dateCreated};i.create(a.patient.id,c).then(function(){setTimeout(function(){e.go("medications",{patientId:a.patient.id,filter:a.query.$,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("gpConnect").controller("MedicationsDetailCtrl",["$scope","$stateParams","$modal","$location","$state","usSpinnerService","PatientService","Medication",function(a,b,c,d,e,f,g,h){g.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.findDetails(b.patientId,b.medicationIndex,b.source).then(function(b){a.medication=b.data,f.stop("medicationsDetail-spinner")}),a.edit=function(){var b=c.open({templateUrl:"views/medications/medications-modal.html",size:"lg",controller:"MedicationsModalCtrl",resolve:{modal:function(){return{title:"Edit Medication"}},medication:function(){return angular.copy(a.medication)},patient:function(){return a.patient}}});b.result.then(function(b){b.startDate=new Date(b.startDate);var c={sourceId:b.sourceId,doseAmount:b.doseAmount,route:b.route,doseDirections:b.doseDirections,doseTiming:b.doseTiming,medicationCode:b.medicationCode,medicationTerminology:b.medicationTerminology,name:b.name,startDate:b.startDate,startTime:b.startTime,source:b.source};h.update(a.patient.id,c).then(function(){setTimeout(function(){e.go("medications-detail",{patientId:a.patient.id,medicationIndex:b.sourceId,page:a.currentPage})},2e3)})})}}]),angular.module("gpConnect").controller("MedicationsModalCtrl",["$scope","$modalInstance","UserService","medication","patient","modal",function(a,b,c,d,e,f){a.currentUser=c.getCurrentUser(),a.medication=d,a.patient=e,a.modal=f,a.routes=["Po Per Oral","IV Intra Venous","PN Per Nasal","PR Per Rectum","SL Sub Lingual","SC Sub Cutaneous","IM Intra Muscular"],"Edit Medication"===f.title?(a.medication.startTime=new Date(a.medication.startTime),a.medication.startDate=new Date(a.medication.startDate).toISOString().slice(0,10),a.medication.dateCreated=new Date(a.medication.dateCreated).toISOString().slice(0,10)):(a.medication.medicationCode=void 0==a.medication.medicationCode?"123456789":a.medication.medicationCode,a.medication.dateCreated=(new Date).toISOString().slice(0,10)),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("gpConnect").controller("AppointmentsCtrl",["$scope","$http","$stateParams","$state","PatientService","usSpinnerService","Appointment",function(a,b,c,d,e,f,g){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),e.findDetails(c.patientId).then(function(b){a.patient=b}),c.filter&&(a.query=c.filter),g.findAllAppointments(c.patientId).then(function(b){var c=b.data;a.appointments=c.entry,void 0!=a.appointments&&(a.appointments=a.appointments.sort(function(a,b){return a.resource.start.localeCompare(b.resource.start)}),$.each(a.appointments,function(a,b){var c=Date.parse(b.resource.start.toString());b.resource.start=moment(c).format("DD-MMM-YYYY HH:mm");var d=Date.parse(b.resource.end.toString());b.resource.end=moment(d).format("DD-MMM-YYYY HH:mm")}))})["catch"](function(a){f.stop("patientSummary-spinner")})["finally"](function(){f.stop("patientSummary-spinner")}),a.go=function(b){f.spin("patientSummary-spinner"),a.appointmentDetail=void 0;for(var c,d=0;d<a.appointments.length;++d)if(c=a.appointments[d],c.resource.id==b){a.appointmentDetail=c;break}$.each(a.appointmentDetail.resource.participant,function(b,c){var d=c.actor.reference.toString();-1!=d.indexOf("Location")?g.findResourceByReference(d).then(function(b){a.appointmentDetail.appointmentLocation=b.data.name}):-1!=d.indexOf("Practitioner")&&g.findResourceByReference(d).then(function(b){a.appointmentDetail.practitionerName=b.data.name.prefix[0]+" "+b.data.name.given[0]+" "+b.data.name.family[0]})}),f.stop("patientSummary-spinner")},a.selected=function(a){return a===c.appointmentIndex}}]),angular.module("gpConnect").controller("ReferralsModalCtrl",["$scope","$modalInstance","UserService","referral","patient","modal",function(a,b,c,d,e,f){$("#dateofreferral").datepicker({dateFormat:"dd-MMM-y"}),a.currentUser=c.getCurrentUser(),a.referral=d,a.patient=e,a.modal=f,"Create Referral"===f.title?(a.referral.dateCreated=(new Date).toISOString().slice(0,10),a.author=a.currentUser):(a.referral.dateCreated=new Date(a.referral.dateCreated).toISOString().slice(0,10),a.referral.dateOfReferral=new Date(a.referral.dateOfReferral).toISOString().slice(0,10)),a.referralCreatedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofReferralDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("gpConnect").controller("ReferralsListCtrl",["$scope","$location","$stateParams","$sce","$modal","$state","usSpinnerService","PatientService","Referral",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.dateOfReferral).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.referralFrom).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.referralTo).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},h.findDetails(c.patientId).then(function(b){a.patient=b.data}),c.filter&&(a.query=c.filter),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No referrals data available for this patient."}';a.referralTable=JSON.parse(c),a.referralTable.html=d.trustAsHtml(a.referralTable.html);var e=b.data,f=e.entry;$.each(f,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.referralTable.html=d.trustAsHtml(c.resource.section[0].text.div),a.referralTable.provider=c.resource.section[0].code.text)}),g.stop("patientSummary-spinner")}),a.go=function(b){f.go("referrals-detail",{patientId:a.patient.id,referralId:b,filter:a.query,page:a.currentPage})},a.selected=function(a){return a===c.referralId},a.create=function(){var b=e.open({templateUrl:"views/referrals/referrals-modal.html",size:"lg",controller:"ReferralsModalCtrl",resolve:{modal:function(){return{title:"Create Referral"}},referral:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfReferral=new Date(b.dateOfReferral),b.dateOfReferral.setMinutes(b.dateOfReferral.getMinutes()-b.dateOfReferral.getTimezoneOffset());var c={author:b.author,clinicalSummary:b.clinicalSummary,dateCreated:new Date(b.dateCreated),dateOfReferral:b.dateOfReferral,reason:b.reason,referralFrom:b.referralFrom,referralTo:b.referralTo};i.create(a.patient.id,c).then(function(){setTimeout(function(){f.go("referrals",{patientId:a.patient.id,filter:a.query,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("gpConnect").controller("ReferralsDetailCtrl",["$scope","$stateParams","$modal","$location","$state","usSpinnerService","PatientService","Referral",function(a,b,c,d,e,f,g,h){g.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.findDetails(b.patientId,b.referralId).then(function(b){a.referral=b.data,f.stop("referralsDetail-spinner")}),a.edit=function(){var b=c.open({templateUrl:"views/referrals/referrals-modal.html",size:"lg",controller:"ReferralsModalCtrl",resolve:{modal:function(){return{title:"Edit Referral"}},referral:function(){return angular.copy(a.referral)},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfReferral=new Date(b.dateOfReferral),b.dateOfReferral.setMinutes(b.dateOfReferral.getMinutes()-b.dateOfReferral.getTimezoneOffset());var c={sourceId:b.sourceId,author:b.author,clinicalSummary:b.clinicalSummary,dateCreated:new Date(b.dateCreated),dateOfReferral:b.dateOfReferral,reason:b.reason,referralFrom:b.referralFrom,referralTo:b.referralTo,source:b.source};h.update(a.patient.id,c).then(function(){setTimeout(function(){e.go("referrals-detail",{patientId:a.patient.id,referralId:b.sourceId,page:a.currentPage})},2e3)})})}}]),angular.module("gpConnect").controller("ProceduresModalCtrl",["$scope","$filter","$modalInstance","UserService","patient","modal","procedure",function(a,b,c,d,e,f,g){a.currentUser=d.getCurrentUser(),a.procedure=g,a.patient=e,a.modal=f,"Create Procedure"===f.title?a.procedure.dateSubmitted=(new Date).toISOString().slice(0,10):(a.procedure.time=new Date(a.procedure.time),a.procedure.dateSubmitted=new Date(a.procedure.dateSubmitted).toISOString().slice(0,10),a.procedure.date=new Date(a.procedure.date).toISOString().slice(0,10)),a.dateofProcedureDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofSubmittedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(b,d){a.formSubmitted=!0,b.$valid&&c.close(d)},a.cancel=function(){c.dismiss("cancel")},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("gpConnect").controller("ProceduresListCtrl",["$scope","$location","$stateParams","$sce","$modal","$state","usSpinnerService","PatientService","Procedure",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.date).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.time).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},h.findDetails(c.patientId).then(function(b){a.patient=b.data}),c.filter&&(a.query=c.filter),i.findAllHTMLTables(c.patientId).then(function(b){if(0==b.data.length){var c='[{"sourceId":"1","source":"Legacy","provider":"No Data","html":"No procedures data available for this patient."}]';a.procedureTables=JSON.parse(c)}else a.procedureTables=b.data;for(var e=0;e<a.procedureTables.length;e++)a.procedureTables[e].html=d.trustAsHtml(a.procedureTables[e].html);g.stop("patientSummary-spinner")}),a.go=function(b,c){f.go("procedures-detail",{patientId:a.patient.id,procedureId:b,filter:a.query,page:a.currentPage,source:c})},a.selected=function(a){return a===c.procedureId},a.create=function(){var b=e.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Create Procedure"}},procedure:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateSubmitted=new Date(b.dateSubmitted),b.date=new Date(b.date),b.date.setMinutes(b.date.getMinutes()-b.date.getTimezoneOffset()),b.time=new Date(b.time.valueOf()-6e4*b.time.getTimezoneOffset());var c={procedureName:b.procedureName,procedureTerminology:b.procedureTerminology,procedureCode:b.procedureCode,notes:b.notes,author:b.author,date:b.date,time:b.time,performer:b.performer,dateSubmitted:b.dateSubmitted};i.create(a.patient.id,c).then(function(){setTimeout(function(){f.go("procedures",{patientId:a.patient.id,filter:a.query,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("gpConnect").controller("ProceduresDetailCtrl",["$scope","$stateParams","$modal","$state","$location","usSpinnerService","PatientService","Procedure",function(a,b,c,d,e,f,g,h){g.findDetails(b.patientId).then(function(b){a.patient=b.data}),h.get(b.patientId,b.procedureId,b.source).then(function(b){a.procedure=b.data,f.stop("proceduresDetail-spinner")}),a.edit=function(){var e=c.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Edit Procedure"}},procedure:function(){return angular.copy(a.procedure)},patient:function(){return a.patient}}});e.result.then(function(c){c.dateSubmitted=new Date(c.dateSubmitted),c.date=new Date(c.date),c.date.setMinutes(c.date.getMinutes()-c.date.getTimezoneOffset());var e={sourceId:c.sourceId,procedureName:c.procedureName,procedureCode:c.procedureCode,procedureTerminology:c.procedureTerminology,notes:c.notes,author:c.author,date:c.date,time:c.time,performer:c.performer,dateSubmitted:c.dateSubmitted,source:c.source};h.update(a.patient.id,e).then(function(){setTimeout(function(){d.go("procedures-detail",{patientId:a.patient.id,procedureId:c.sourceId,page:a.currentPage,source:b.source})},2e3)})})}}]),angular.module("gpConnect").controller("ObservationsListCtrl",["$scope","$location","$stateParams","$sce","$modal","usSpinnerService","$state","PatientService","Observation",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.testName).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.sampleTaken).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateCreated).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No observation data available for this patient."}';a.observationTable=JSON.parse(c),a.observationTable.html=d.trustAsHtml(a.observationTable.html);var e=b.data,g=e.entry;$.each(g,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.observationTable.html=d.trustAsHtml(c.resource.section[0].text.div),a.observationTable.provider=c.resource.section[0].code.text)}),f.stop("patientSummary-spinner")}),a.go=function(b,c){g.go("observations-detail",{patientId:a.patient.id,resultIndex:b,source:c,filter:a.query,page:a.currentPage})},a.selected=function(a){return a===c.resultIndex}}]),angular.module("gpConnect").controller("ObservationsDetailCtrl",["$scope","$stateParams","$modal","$location","usSpinnerService","PatientService","Observation",function(a,b,c,d,e,f,g){f.findDetails(b.patientId).then(function(b){a.patient=b.data}),Result.findDetails(b.patientId,b.resultIndex,b.source).then(function(b){a.result=b.data,e.stop("observationsDetail-spinner")})}]),angular.module("gpConnect").controller("MainSearchController",["$scope","$state","$timeout","AdvancedSearch","PatientService",function(a,b,c,d,e){a.mainSearchEnabled=!0,a.searchExpression="",a.errorOccurred=!1,a.openAdvancedSearch=d.openAdvancedSearch,a.cancelSearchMode=function(){a.searchExpression=""},a.searchFunction=function(b){var c=b.replace(/\s+/g,"");isNaN(c)||10!=c.length?a.setErrorOccurred(!0):e.findDetails(c).then(function(a){f(a.data.nhsNumber)})["catch"](function(){a.setErrorOccurred(!0)})},a.setErrorOccurred=function(b){c(function(){a.$apply(function(){a.errorOccurred=b},1e3)})},a.populateSearchField=function(b){c(function(){a.$apply(function(){a.searchExpression=b},1e3)})};var f=function(c){b.go("patients-summary",{patientId:c,filter:a.query})}}]),angular.module("gpConnect").controller("AdvancedSearchController",["$scope","$modalInstance","$state","modal","searchParams","AdvancedSearch",function(a,b,c,d,e,f){a.modal=d,a.searchParams=e,a.formSubmitted=!1,a.detailsFocused=!1,a.modalReopened=!1,a.searchParams.nhsNumber?a.nhsNumberFocus=!0:a.searchParams.surname?a.surnameFocus=!0:a.nhsNumberFocus=!0,a.searchParams.dateOfBirth&&(a.searchParams.dateOfBirth=new Date(a.searchParams.dateOfBirth).toISOString().slice(0,10),a.detailsFocused=!0,a.modalReopened=!0),a.cancel=function(){b.dismiss("cancel")},a.ok=function(b){b.$valid&&f.searchByDetails(a.searchParams).then(function(b){a.patients=b.data,g()})};var g=function(){a.formSubmitted=!0,b.close(),1==a.patients.length?c.go("patients-summary",{patientId:a.patients[0].nhsNumber}):a.patients.length>1?c.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams}):c.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams,displayEmptyTable:!0})};a.openDatePicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.isNhsNumberRequired=function(b){var c=a.advancedSearchForm.nhsNumber.$viewValue;if(void 0===c&&a.areDetailsFieldsClean(b))return!0;c=c.replace(/\s+/g,"");var d=isNaN(c)||b.nhsNumber.$invalid&&0===c.length;return d&&a.areDetailsFieldsClean(b)},a.isNhsNumberTooShort=function(a){if(void 0===a)return!1;var b=a.replace(/\s+/g,"");return!isNaN(b)&&b.length>0&&b.length<10},a.isNhsNumberTooLong=function(a){if(void 0===a)return!1;var b=a.replace(/\s+/g,"");return!isNaN(b)&&b.length>10},a.isNhsNumberFieldInvalid=function(a){return a.$invalid||a.$pristine},a.areDetailsFieldsClean=function(b){var c=b.surname,d=b.forename,e=b.dateOfBirth,f=c.$invalid||!a.searchParams.surname||""==a.searchParams.surname,g=d.$invalid||!a.searchParams.forename||""==a.searchParams.forename,h=e.$invalid||!a.searchParams.dateOfBirth||""==a.searchParams.dateOfBirth;return f&&g&&h}}]),angular.module("gpConnect").controller("EncountersListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","PatientService","usSpinnerService","Encounter",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),g.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No encounters data available for this patient."}';a.encounterTable=JSON.parse(c),a.encounterTable.html=f.trustAsHtml(a.encounterTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.encounterTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.encounterTable.provider=c.resource.section[0].code.text)}),h.stop("encounterSummary-spinner")})}]),angular.module("gpConnect").controller("ImmunisationsListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","PatientService","usSpinnerService","Immunisation",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),g.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No immunisations data available for this patient."}';a.immunisationTable=JSON.parse(c),a.immunisationTable.html=f.trustAsHtml(a.immunisationTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.immunisationTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.immunisationTable.provider=c.resource.section[0].code.text)}),h.stop("patientSummary-spinner")})}]),angular.module("gpConnect").controller("AdminItemsListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","PatientService","usSpinnerService","AdminItem",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),g.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No administrative items data available for this patient."}';a.adminItemTable=JSON.parse(c),a.adminItemTable.html=f.trustAsHtml(a.adminItemTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.adminItemTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.adminItemTable.provider=c.resource.section[0].code.text)}),h.stop("patientSummary-spinner")})}]),angular.module("gpConnect").controller("ClinicalItemsListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","PatientService","usSpinnerService","ClinicalItem",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),g.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No clinical item data available for this patient."}';a.clinicalItemTable=JSON.parse(c),a.clinicalItemTable.html=f.trustAsHtml(a.clinicalItemTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.clinicalItemTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.clinicalItemTable.provider=c.resource.section[0].code.text)}),h.stop("patientSummary-spinner")})}]),angular.module("gpConnect").controller("InvestigationsListCtrl",["$scope","$location","$stateParams","$modal","$state","$sce","PatientService","usSpinnerService","Investigation",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),g.findDetails(c.patientId).then(function(b){a.patient=b.data}),i.findAllHTMLTables(c.patientId).then(function(b){var c='{"provider":"No Data","html":"No investigation data available for this patient."}';a.investigationTable=JSON.parse(c),a.investigationTable.html=f.trustAsHtml(a.investigationTable.html);var d=b.data,e=d.entry;$.each(e,function(b,c){"Patient"==c.resource.resourceType,"Composition"==c.resource.resourceType&&"425173008"==c.resource.type.coding[0].code&&void 0!=c.resource.section&&(a.investigationTable.html=f.trustAsHtml(c.resource.section[0].text.div),a.investigationTable.provider=c.resource.section[0].code.text)}),h.stop("patientSummary-spinner")})}]);